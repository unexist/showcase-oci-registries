version: '3'

tasks:
  cyclonex:
    cmds:
      - |
        podman run -it --rm \
          -v ./todo-service:/in \
          -v ./sbom.json:/out/sbom.json:z \
          docker.io/cyclonedx/cyclonedx-gomod:v1 mod -json -output /out/sbom.json /in
    sources:
      - todo-service/**/*.go
    generates:
      - "{{.SBOM_FILE}}"

  syft:
    cmds:
      - |
        podman run -it --rm \
          -v ./todo-service:/in \
          -v ./sbom.json:/out/sbom.json:z \
          docker.io/anchore/syft:latest scan dir:/in -o cyclonedx-json=/out/sbom.json
    sources:
      - todo-service/**/*.go
    generates:
      - "{{.SBOM_FILE}}"
