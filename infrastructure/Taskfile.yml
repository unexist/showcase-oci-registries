version: '3'
env:
  REGISTRY_URL: '{{.REGISTRY_URL | default "localhost:8000"}}'
  USERNAME: '{{.USERNAME | default "user"}}'
  PASSWORD: '{{.PASSWORD | default "test"}}'

tasks:
  oras:
    cmds:
      - |
        podman run --rm -v .:/workspace -it --name oras \
          ghcr.io/oras-project/oras:latest {{.ARGS}}

  oras-login:
    cmds:
      - task: oras
        vars: { ARGS: "login -u {{.USERNAME}} -p {{.PASSWORD}} {{.REGISTRY_URL}}" }

  simple-registry:
    cmds:
      - |
        podman run --rm -it --name simple-registry -p 5000:5000 \
          -v ./infrastructure/simple-registry/config.toml:/config.toml \
          ghcr.io/simple-registry/simple-registry:main \
          server

  zot-registry:
    cmds:
      - |
        podman run --rm -it --name simple-registry -p 5000:5000 \
          -v ./infrastructure/zot-registry/config.json:/etc/zot/config.json \
        ghcr.io/project-zot/zot-linux-amd64:v2.1.2
